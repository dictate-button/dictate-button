"use strict";const yt=(t,e)=>t===e,j={equals:yt};let _t=at;const m=1,B=2,nt={owned:null,cleanups:null,context:null,owner:null};var y=null;let V=null,wt=null,p=null,g=null,S=null,F=0;function Ct(t,e){const n=p,r=y,s=t.length===0,o=e===void 0?r:e,l=s?nt:{owned:null,cleanups:null,context:o?o.context:null,owner:o},i=s?t:()=>t(()=>G(()=>x(l)));y=l,p=null;try{return T(i,!0)}finally{p=n,y=r}}function st(t,e){e=e?Object.assign({},j,e):j;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),ot(n,s));return[rt.bind(n),r]}function R(t,e,n){const r=it(t,e,!1,m);L(r)}function St(t,e,n){n=n?Object.assign({},j,n):j;const r=it(t,e,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,L(r),rt.bind(r)}function G(t){if(p===null)return t();const e=p;p=null;try{return t()}finally{p=e}}function rt(){if(this.sources&&this.state)if(this.state===m)L(this);else{const t=g;g=null,T(()=>I(this),!1),g=t}if(p){const t=this.observers?this.observers.length:0;p.sources?(p.sources.push(this),p.sourceSlots.push(t)):(p.sources=[this],p.sourceSlots=[t]),this.observers?(this.observers.push(p),this.observerSlots.push(p.sources.length-1)):(this.observers=[p],this.observerSlots=[p.sources.length-1])}return this.value}function ot(t,e,n){let r=t.value;return(!t.comparator||!t.comparator(r,e))&&(t.value=e,t.observers&&t.observers.length&&T(()=>{for(let s=0;s<t.observers.length;s+=1){const o=t.observers[s],l=V&&V.running;l&&V.disposed.has(o),(l?!o.tState:!o.state)&&(o.pure?g.push(o):S.push(o),o.observers&&ct(o)),l||(o.state=m)}if(g.length>1e6)throw g=[],new Error},!1)),e}function L(t){if(!t.fn)return;x(t);const e=F;mt(t,t.value,e)}function mt(t,e,n){let r;const s=y,o=p;p=y=t;try{r=t.fn(e)}catch(l){return t.pure&&(t.state=m,t.owned&&t.owned.forEach(x),t.owned=null),t.updatedAt=n+1,ut(l)}finally{p=o,y=s}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?ot(t,r):t.value=r,t.updatedAt=n)}function it(t,e,n,r=m,s){const o={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:y,context:y?y.context:null,pure:n};return y===null||y!==nt&&(y.owned?y.owned.push(o):y.owned=[o]),o}function lt(t){if(t.state===0)return;if(t.state===B)return I(t);if(t.suspense&&G(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<F);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===m)L(t);else if(t.state===B){const r=g;g=null,T(()=>I(t,e[0]),!1),g=r}}function T(t,e){if(g)return t();let n=!1;e||(g=[]),S?n=!0:S=[],F++;try{const r=t();return vt(n),r}catch(r){n||(S=null),g=null,ut(r)}}function vt(t){if(g&&(at(g),g=null),t)return;const e=S;S=null,e.length&&T(()=>_t(e),!1)}function at(t){for(let e=0;e<t.length;e++)lt(t[e])}function I(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];if(r.sources){const s=r.state;s===m?r!==e&&(!r.updatedAt||r.updatedAt<F)&&lt(r):s===B&&I(r,e)}}}function ct(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=B,n.pure?g.push(n):S.push(n),n.observers&&ct(n))}}function x(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const o=s.pop(),l=n.observerSlots.pop();r<s.length&&(o.sourceSlots[l]=r,s[r]=o,n.observerSlots[r]=l)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)x(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)x(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function At(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function ut(t,e=y){throw At(t)}function M(t,e){return G(()=>t(e||{}))}const P=t=>St(()=>t());function Et(t,e,n){let r=n.length,s=e.length,o=r,l=0,i=0,a=e[s-1].nextSibling,u=null;for(;l<s||i<o;){if(e[l]===n[i]){l++,i++;continue}for(;e[s-1]===n[o-1];)s--,o--;if(s===l){const f=o<r?i?n[i-1].nextSibling:n[o-i]:a;for(;i<o;)t.insertBefore(n[i++],f)}else if(o===i)for(;l<s;)(!u||!u.has(e[l]))&&e[l].remove(),l++;else if(e[l]===n[o-1]&&n[i]===e[s-1]){const f=e[--s].nextSibling;t.insertBefore(n[i++],e[l++].nextSibling),t.insertBefore(n[--o],f),e[s]=n[o]}else{if(!u){u=new Map;let b=i;for(;b<o;)u.set(n[b],b++)}const f=u.get(e[l]);if(f!=null)if(i<f&&f<o){let b=l,w=1,C;for(;++b<s&&b<o&&!((C=u.get(e[b]))==null||C!==f+w);)w++;if(w>f-i){const K=e[l];for(;i<f;)t.insertBefore(n[i++],K)}else t.replaceChild(n[i++],e[l++])}else l++;else e[l++].remove()}}}const J="_$DX_DELEGATE";function $(t,e,n,r){let s;const o=()=>{const i=document.createElement("template");return i.innerHTML=t,i.content.firstChild},l=()=>(s||(s=o())).cloneNode(!0);return l.cloneNode=l,l}function xt(t,e=window.document){const n=e[J]||(e[J]=new Set);for(let r=0,s=t.length;r<s;r++){const o=t[r];n.has(o)||(n.add(o),e.addEventListener(o,$t))}}function ft(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function Tt(t,e,n){if(!e)return n?ft(t,"style"):e;const r=t.style;if(typeof e=="string")return r.cssText=e;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),e||(e={});let s,o;for(o in n)e[o]==null&&r.removeProperty(o),delete n[o];for(o in e)s=e[o],s!==n[o]&&(r.setProperty(o,s),n[o]=s);return n}function E(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return D(t,e,r,n);R(s=>D(t,e(),s,n),r)}function $t(t){let e=t.target;const n=`$$${t.type}`,r=t.target,s=t.currentTarget,o=a=>Object.defineProperty(t,"target",{configurable:!0,value:a}),l=()=>{const a=e[n];if(a&&!e.disabled){const u=e[`${n}Data`];if(u!==void 0?a.call(e,u,t):a.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&o(e.host),!0},i=()=>{for(;l()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const a=t.composedPath();o(a[0]);for(let u=0;u<a.length-2&&(e=a[u],!!l());u++){if(e._$host){e=e._$host,i();break}if(e.parentNode===s)break}}else i();o(r)}function D(t,e,n,r,s){for(;typeof n=="function";)n=n();if(e===n)return n;const o=typeof e,l=r!==void 0;if(t=l&&n[0]&&n[0].parentNode||t,o==="string"||o==="number"){if(o==="number"&&(e=e.toString(),e===n))return n;if(l){let i=n[0];i&&i.nodeType===3?i.data!==e&&(i.data=e):i=document.createTextNode(e),n=v(t,n,r,i)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||o==="boolean")n=v(t,n,r);else{if(o==="function")return R(()=>{let i=e();for(;typeof i=="function";)i=i();n=D(t,i,n,r)}),()=>n;if(Array.isArray(e)){const i=[],a=n&&Array.isArray(n);if(H(i,e,n,s))return R(()=>n=D(t,i,n,r,!0)),()=>n;if(i.length===0){if(n=v(t,n,r),l)return n}else a?n.length===0?Q(t,i,r):Et(t,n,i):(n&&v(t),Q(t,i));n=i}else if(e.nodeType){if(Array.isArray(n)){if(l)return n=v(t,n,r,e);v(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function H(t,e,n,r){let s=!1;for(let o=0,l=e.length;o<l;o++){let i=e[o],a=n&&n[t.length],u;if(!(i==null||i===!0||i===!1))if((u=typeof i)=="object"&&i.nodeType)t.push(i);else if(Array.isArray(i))s=H(t,i,a)||s;else if(u==="function")if(r){for(;typeof i=="function";)i=i();s=H(t,Array.isArray(i)?i:[i],Array.isArray(a)?a:[a])||s}else t.push(i),s=!0;else{const f=String(i);a&&a.nodeType===3&&a.data===f?t.push(a):t.push(document.createTextNode(f))}}return s}function Q(t,e,n=null){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function v(t,e,n,r){if(n===void 0)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let o=!1;for(let l=e.length-1;l>=0;l--){const i=e[l];if(s!==i){const a=i.parentNode===t;!o&&!l?a?t.replaceChild(s,i):t.insertBefore(s,n):a&&i.remove()}else o=!0}}else t.insertBefore(s,n);return[s]}function kt(t){return Object.keys(t).reduce((n,r)=>{const s=t[r];return n[r]=Object.assign({},s),ht(s.value)&&!jt(s.value)&&!Array.isArray(s.value)&&(n[r].value=Object.assign({},s.value)),Array.isArray(s.value)&&(n[r].value=s.value.slice(0)),n},{})}function Ot(t){return t?Object.keys(t).reduce((n,r)=>{const s=t[r];return n[r]=ht(s)&&"value"in s?s:{value:s},n[r].attribute||(n[r].attribute=Nt(r)),n[r].parse="parse"in n[r]?n[r].parse:typeof n[r].value!="string",n},{}):{}}function Mt(t){return Object.keys(t).reduce((n,r)=>(n[r]=t[r].value,n),{})}function Pt(t,e){const n=kt(e);return Object.keys(e).forEach(s=>{const o=n[s],l=t.getAttribute(o.attribute),i=t[s];l!=null&&(o.value=o.parse?dt(l):l),i!=null&&(o.value=Array.isArray(i)?i.slice(0):i),o.reflect&&Y(t,o.attribute,o.value,!!o.parse),Object.defineProperty(t,s,{get(){return o.value},set(a){const u=o.value;o.value=a,o.reflect&&Y(this,o.attribute,o.value,!!o.parse);for(let f=0,b=this.__propertyChangedCallbacks.length;f<b;f++)this.__propertyChangedCallbacks[f](s,a,u)},enumerable:!0,configurable:!0})}),n}function dt(t){if(t)try{return JSON.parse(t)}catch{return t}}function Y(t,e,n,r){if(n==null||n===!1)return t.removeAttribute(e);let s=r?JSON.stringify(n):n;t.__updating[e]=!0,s==="true"&&(s=""),t.setAttribute(e,s),Promise.resolve().then(()=>delete t.__updating[e])}function Nt(t){return t.replace(/\.?([A-Z]+)/g,(e,n)=>"-"+n.toLowerCase()).replace("_","-").replace(/^-/,"")}function ht(t){return t!=null&&(typeof t=="object"||typeof t=="function")}function jt(t){return Object.prototype.toString.call(t)==="[object Function]"}function Bt(t){return typeof t=="function"&&t.toString().indexOf("class")===0}let q;function Rt(t,e){const n=Object.keys(e);return class extends t{static get observedAttributes(){return n.map(s=>e[s].attribute)}constructor(){super(),this.__initialized=!1,this.__released=!1,this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props={}}connectedCallback(){if(this.__initialized)return;this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props=Pt(this,e);const s=Mt(this.props),o=this.Component,l=q;try{q=this,this.__initialized=!0,Bt(o)?new o(s,{element:this}):o(s,{element:this})}finally{q=l}}async disconnectedCallback(){if(await Promise.resolve(),this.isConnected)return;this.__propertyChangedCallbacks.length=0;let s=null;for(;s=this.__releaseCallbacks.pop();)s(this);delete this.__initialized,this.__released=!0}attributeChangedCallback(s,o,l){if(this.__initialized&&!this.__updating[s]&&(s=this.lookupProp(s),s in e)){if(l==null&&!this[s])return;this[s]=e[s].parse?dt(l):l}}lookupProp(s){if(e)return n.find(o=>s===o||s===e[o].attribute)}get renderRoot(){return this.shadowRoot||this.attachShadow({mode:"open"})}addReleaseCallback(s){this.__releaseCallbacks.push(s)}addPropertyChangedCallback(s){this.__propertyChangedCallbacks.push(s)}}}function It(t,e={},n={}){const{BaseElement:r=HTMLElement,extension:s,customElements:o=window.customElements}=n;return l=>{let i=o.get(t);return i?(i.prototype.Component=l,i):(i=Rt(r,Ot(e)),i.prototype.Component=l,i.prototype.registeredTag=t,o.define(t,i,s),i)}}function Dt(t){const e=Object.keys(t),n={};for(let r=0;r<e.length;r++){const[s,o]=st(t[e[r]]);Object.defineProperty(n,e[r],{get:s,set(l){o(()=>l)}})}return n}function Ft(t){if(t.assignedSlot&&t.assignedSlot._$owner)return t.assignedSlot._$owner;let e=t.parentNode;for(;e&&!e._$owner&&!(e.assignedSlot&&e.assignedSlot._$owner);)e=e.parentNode;return e&&e.assignedSlot?e.assignedSlot._$owner:t._$owner}function Lt(t){return(e,n)=>{const{element:r}=n;return Ct(s=>{const o=Dt(e);r.addPropertyChangedCallback((i,a)=>o[i]=a),r.addReleaseCallback(()=>{r.renderRoot.textContent="",s()});const l=t(o,n);return E(r.renderRoot,l)},Ft(r))}}function Kt(t,e,n){return arguments.length===2&&(n=e,e={}),It(t,e)(Lt(n))}const Ut=`
:host([theme="dark"]) {
  color-scheme: only dark;
}
:host([theme="light"]) {
  color-scheme: only light;
}

:host .dictate-button__container {
  margin: 5px;
}

:host .dictate-button__button {
  cursor: pointer;
  padding: 2px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  opacity: 0.8;
  transition: opacity 0.2s ease-in-out;
  border-radius: 50%;
  border: 12px solid transparent;
  box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.3);
  transition: box-shadow 0.05s linear;
}

:host .dictate-button__button .dictate-button__icon {
  width: 100%;
  height: 100%;
}

:host .dictate-button__button .dictate-button__icon.dictate-button__icon--processing {
  animation: dictate-button-rotate 1s linear infinite;
}

@keyframes dictate-button-rotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
`;var Vt=$("<div part=container class=dictate-button__container><style></style><button part=button class=dictate-button__button>"),qt=$('<svg part=icon class="dictate-button__icon dictate-button__icon--idle"fill=none viewBox="0 0 24 24"stroke-width=1.5 stroke=currentColor><path stroke-linecap=round stroke-linejoin=round d="M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z">'),zt=$('<svg part=icon class="dictate-button__icon dictate-button__icon--recording"viewBox="0 0 24 24"fill=currentColor><path fill-rule=evenodd d="M4.5 7.5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-9a3 3 0 0 1-3-3v-9Z"clip-rule=evenodd>'),Ht=$('<svg part=icon class="dictate-button__icon dictate-button__icon--processing"viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=1.5 stroke-linecap=round stroke-linejoin=round><path d="M12 2v4"></path><path d="m16.2 7.8 2.9-2.9"></path><path d="M18 12h4"></path><path d="m16.2 16.2 2.9 2.9"></path><path d="M12 18v4"></path><path d="m4.9 19.1 2.9-2.9"></path><path d="M2 12h4"></path><path d="m4.9 4.9 2.9 2.9">'),Gt=$('<svg part=icon class="dictate-button__icon dictate-button__icon--error"fill=none viewBox="0 0 24 24"stroke-width=1.5 stroke=currentColor><path stroke-linecap=round stroke-linejoin=round d="M6 18 18 6M6 6l12 12">');console.debug("dictate-button version:","0.3.0");const Wt="https://api.dictate-button.io/transcribe",N="dictate-button.io",z=-70,tt=-10,et=0,Xt=12,Zt=.25,Jt=.05;Kt("dictate-button",{size:24,apiEndpoint:Wt,language:void 0},(t,{element:e})=>{const{size:n,apiEndpoint:r,language:s}=t;console.debug("api",r);const[o,l]=st("idle");let i=null,a=[],u=null,f=null,b=null,w=!1,C=0;const K=d=>d<=z?0:d>=tt?1:(d-z)/(tt-z),pt=d=>{let _=0;for(let h=0;h<d.length;h++){const c=(d[h]-128)/128;_+=c*c}return Math.sqrt(_/d.length)},gt=d=>20*Math.log10(Math.max(d,1e-8)),W=d=>{const _=e.querySelector(".dictate-button__button");if(_){const h=et+d*(Xt-et),c=.3+d*.4;_.style.boxShadow=`0 0 0 ${h}px rgba(255,255,255,${c})`}},X=()=>{if(!w||!f||!b)return;f.getByteTimeDomainData(b);const d=pt(b),_=gt(d),h=K(_),c=h>C?Zt:Jt;C=c*h+(1-c)*C,W(C),requestAnimationFrame(X)},U=()=>{i&&i.state!=="inactive"&&i.stop(),a=[],w=!1,u&&u.state!=="closed"&&u.close(),u=null,f=null,b=null,C=0,W(0)};e.addEventListener("disconnected",U);const bt=async()=>{if(U(),o()==="idle")try{const d=await navigator.mediaDevices.getUserMedia({audio:!0});u=new(window.AudioContext||window.webkitAudioContext);const _=u.createMediaStreamSource(d);f=u.createAnalyser(),f.fftSize=2048,_.connect(f),b=new Uint8Array(f.fftSize),i=new MediaRecorder(d,{mimeType:"audio/webm"}),a=[],i.ondataavailable=h=>{a.push(h.data)},i.onstop=async()=>{w=!1,l("processing"),A(e,"transcribing:started","Started transcribing");const h=new Blob(a,{type:"audio/webm"});try{const c=new FormData;c.append("audio",h,"recording.webm"),c.append("origin",window?.location?.origin),s&&c.append("language",s);const k=await fetch(r,{method:"POST",body:c});if(!k.ok)throw new Error("Failed to transcribe audio");const O=await k.json();if(o()!=="processing")return;A(e,"transcribing:finished",O.text),l("idle")}catch(c){console.error("Failed to transcribe audio:",c),A(e,"transcribing:failed","Failed to transcribe audio"),Z()}},i.start(),A(e,"recording:started","Started recording"),w=!0,X(),l("recording")}catch(d){console.error("Failed to start recording:",d),A(e,"recording:failed","Failed to start recording"),Z()}else A(e,"recording:stopped","Stopped recording"),l("idle"),U()},Z=()=>{l("error"),setTimeout(()=>l("idle"),2e3)};return(()=>{var d=Vt(),_=d.firstChild,h=_.nextSibling;return E(_,Ut),h.$$click=bt,E(h,(()=>{var c=P(()=>o()==="idle");return()=>c()&&M(Yt,{})})(),null),E(h,(()=>{var c=P(()=>o()==="recording");return()=>c()&&M(te,{})})(),null),E(h,(()=>{var c=P(()=>o()==="processing");return()=>c()&&M(ee,{})})(),null),E(h,(()=>{var c=P(()=>o()==="error");return()=>c()&&M(ne,{})})(),null),R(c=>{var k=`width:${n}px;height:${n}px"`,O=Qt(o());return c.e=Tt(h,k,c.e),O!==c.t&&ft(h,"title",c.t=O),c},{e:void 0,t:void 0}),d})()});const Qt=t=>{switch(t){case"idle":return`Start dictation (${N})`;case"recording":return`Stop dictation (${N})`;case"processing":return`Stop processing (${N})`;case"error":return`Click to reset (${N})`}},A=(t,e,n)=>{t.dispatchEvent(new CustomEvent(e,{detail:n,bubbles:!0,composed:!0}))},Yt=()=>qt(),te=()=>zt(),ee=()=>Ht(),ne=()=>Gt();xt(["click"]);
